{$CLEO .cs}

Alloc($PLAYER_ACTOR, 3)

script_name 'HEAVYCAR'
// == Credit ==
// Originally created by The AnonMod ANG
// Modified by Invictus
// Original Script: https://www.gtainside.com/en/sanandreas/mods/43308-heavy-car-v3/

function get_car_data(): int, int
    int health = Car.GetHealth(1@)
    int traction = 1.0
    return health traction
end

function restore_car_stats(health: int, traction: int)
    Car.SetHeavy(1@, False)
    Car.SetCanBeVisiblyDamaged(1@, True)
    Car.SetPetrolTankWeakpoint(1@, True)
    Car.SetHealth(1@, health)
    Car.SetTraction(1@, traction)
end

function set_car_to_heavy()
    Car.Fix(1@)
    Car.SetHeavy(1@, True)
    Car.SetCanBeVisiblyDamaged(1@, False)
    Car.SetPetrolTankWeakpoint(1@, False)
    Car.SetHealth(1@, 10000)
    Car.SetTraction(1@, 2.0)
end

:main
wait 0

// Check if the player is active; return to main loop if not
if not Player.IsPlaying($PLAYER_ACTOR)
then
    goto @main
end

// Check if the player is in a car; return to main loop if not
if Char.IsInAnyCar($PLAYER_ACTOR)    
then
    1@ = Char.StoreCarIsIn($PLAYER_ACTOR)
    int health, traction
    health, traction = get_car_data()
    set_car_to_heavy()
    Text.PrintHelp("Heavy Car Activated", 1000)
else
    restore_car_stats(health, traction)
    goto @main
end

goto @main
